<template>
  <!-- Modal para edição/criação de compromissos -->
  <template if:true={showModal}>
    <div class="modal-container">
      <section
        role="dialog"
        tabindex="-1"
        aria-labelledby="appointment-modal-heading"
        aria-modal="true"
        aria-describedby="appointment-modal-content"
        class="slds-modal slds-fade-in-open"
      >
        <div class="slds-modal__container">
          <!-- Modal Header -->
          <header class="slds-modal__header">
            <button
              class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse"
              title="Fechar"
              onclick={closeModal}
            >
              <lightning-icon
                icon-name="utility:close"
                alternative-text="Fechar"
                size="small"
              ></lightning-icon>
              <span class="slds-assistive-text">Fechar</span>
            </button>
            <h2
              id="appointment-modal-heading"
              class="slds-modal__title slds-hyphenate"
            >
              <lightning-icon
                icon-name="standard:event"
                size="small"
                class="slds-m-right_small"
              ></lightning-icon>
              {eventData.subject}
            </h2>
            <p class="slds-m-top_x-small">Edite os detalhes do compromisso</p>
          </header>

          <!-- Modal Body -->
          <div
            class="slds-modal__content slds-p-around_medium"
            id="appointment-modal-content"
          >
            <template if:true={isLoading}>
              <div class="slds-is-relative slds-p-around_large">
                <lightning-spinner
                  variant="brand"
                  alternative-text="Carregando"
                  size="medium"
                ></lightning-spinner>
              </div>
            </template>

            <template if:false={isLoading}>
              <template if:true={error}>
                <div
                  class="slds-notify slds-notify_alert slds-alert_error"
                  role="alert"
                >
                  <lightning-icon
                    icon-name="utility:error"
                    size="small"
                    class="slds-m-right_small"
                  ></lightning-icon>
                  <h2>{error}</h2>
                </div>
              </template>

              <!-- Tab Navigation -->
              <div class="slds-tabs_default">
                <ul class="slds-tabs_default__nav" role="tablist">
                  <li class="slds-tabs_default__item" role="presentation">
                    <a
                      class={eventTabClass}
                      href="#"
                      role="tab"
                      tabindex="0"
                      aria-selected={isEventTabActive}
                      aria-controls="event-tab-content"
                      id="event-tab"
                      onclick={handleEventTabClick}
                    >
                      <lightning-icon
                        icon-name="standard:event"
                        size="x-small"
                        class="slds-m-right_x-small"
                      ></lightning-icon>
                      Informações do Evento
                    </a>
                  </li>
                  <li class="slds-tabs_default__item" role="presentation">
                    <a
                      class={opportunityTabClass}
                      href="#"
                      role="tab"
                      tabindex="-1"
                      aria-selected={isOpportunityTabActive}
                      aria-controls="opportunity-tab-content"
                      id="opportunity-tab"
                      onclick={handleOpportunityTabClick}
                    >
                      <lightning-icon
                        icon-name="standard:opportunity"
                        size="x-small"
                        class="slds-m-right_x-small"
                      ></lightning-icon>
                      Informações da Oportunidade
                    </a>
                  </li>
                </ul>

                <!-- Event Tab Content -->
                <div
                  id="event-tab-content"
                  class={eventTabContentClass}
                  role="tabpanel"
                  aria-labelledby="event-tab"
                >
                  <!-- Detalhes do Compromisso -->
                  <div class="section-container">
                    <div class="section-header">
                      <h3 class="section-title">Detalhes do Compromisso</h3>
                    </div>

                    <div class="slds-p-around_medium">
                      <div class="slds-form">
                        <div class="slds-grid slds-wrap">
                          <!-- Assunto do Compromisso - Read-only, auto-generated -->
                          <!-- <div
                            class="slds-col slds-size_1-of-1 slds-p-horizontal_small slds-p-bottom_small"
                          >
                            <div class="subject-card">
                              <div class="subject-label">
                                <lightning-icon
                                  icon-name="utility:text"
                                  size="x-small"
                                  class="slds-m-right_x-small"
                                ></lightning-icon>
                                Assunto (Gerado Automaticamente)
                              </div>
                              <div class="subject-value">
                                {eventData.subject}
                              </div>
                            </div>
                          </div> -->

                          <!-- Fase do Evento -->
                          <div
                            class="slds-col slds-size_1-of-2 slds-p-horizontal_small slds-p-bottom_small"
                          >
                            <lightning-combobox
                              label="Fase do Evento"
                              value={eventData.faseEvento}
                              options={faseEventoOptions}
                              name="faseEvento"
                              onchange={handleFieldChange}
                              placeholder="Selecione a fase..."
                              variant="standard"
                            >
                            </lightning-combobox>
                          </div>

                          <!-- Produto do Evento -->
                          <div
                            class="slds-col slds-size_1-of-2 slds-p-horizontal_small slds-p-bottom_small"
                          >
                            <lightning-combobox
                              label="Produto do Evento"
                              value={eventData.produtoEvento}
                              options={produtoEventoOptions}
                              name="produtoEvento"
                              onchange={handleFieldChange}
                              placeholder="Selecione o produto..."
                              variant="standard"
                              disabled
                            >
                            </lightning-combobox>
                          </div>

                          <!-- Tipo de Compromisso - Moved to appear right after Subject -->
                          <div
                            class="slds-col slds-size_1-of-1 slds-p-horizontal_small slds-p-bottom_medium"
                          >
                            <div class="slds-form-element">
                              <label
                                class="slds-form-element__label"
                                for="appointment-type"
                                >Tipo de Compromisso</label
                              >
                              <div class="slds-form-element__control">
                                <div class="cards-carousel-container">
                                  <div class="cards-carousel">
                                    <!-- Card Reunião Presencial -->
                                    <div
                                      class={reuniaoPresencialClass}
                                      data-type="Reunião Presencial"
                                      onclick={handleTypeCardClick}
                                    >
                                      <div class="card-header">
                                        <lightning-icon
                                          icon-name="standard:location"
                                          size="small"
                                          class="slds-m-bottom_x-small"
                                        ></lightning-icon>
                                      </div>
                                      <div class="card-title">Presencial</div>
                                    </div>

                                    <!-- Card Reunião Online -->
                                    <div
                                      class={reuniaoOnlineClass}
                                      data-type="Reunião Online"
                                      onclick={handleTypeCardClick}
                                    >
                                      <div class="card-header">
                                        <lightning-icon
                                          icon-name="standard:video"
                                          size="small"
                                          class="slds-m-bottom_x-small"
                                        ></lightning-icon>
                                      </div>
                                      <div class="card-title">
                                        Reunião Online
                                      </div>
                                    </div>

                                    <!-- Card Ligação Telefônica -->
                                    <div
                                      class={ligacaoTelefonicaClass}
                                      data-type="Ligação Telefônica"
                                      onclick={handleTypeCardClick}
                                    >
                                      <div class="card-header">
                                        <lightning-icon
                                          icon-name="standard:call"
                                          size="small"
                                          class="slds-m-bottom_x-small"
                                        ></lightning-icon>
                                      </div>
                                      <div class="card-title">Por Telefone</div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>







                          <!-- Sala de Reunião (sempre visível) -->
                          <div class="section-container">
                            <div class="section-header">
                              <h3 class="section-title">
                                <lightning-icon
                                  icon-name="standard:location"
                                  size="x-small"
                                  class="slds-m-right_x-small"
                                ></lightning-icon>
                                Sala de Reunião
                              </h3>
                            </div>

                            <div class="slds-p-around_medium">
                              <div class="slds-form-element">
                                <div class="slds-form-element__control">
                                  <div class="cards-carousel-container">
                                    <div class="cards-carousel">
                                      <!-- Card Sala Principal -->
                                      <div
                                        class={salaPrincipalCardClass}
                                        data-value="salaPrincipal"
                                        onclick={handleSalaSelect}
                                      >
                                        <div class="card-row">
                                          <span
                                            class="color-dot color-dot-green"
                                          ></span>
                                          <div class="card-title">
                                            Sala Principal
                                          </div>
                                        </div>
                                      </div>

                                      <!-- Card Sala do Gabriel -->
                                      <div
                                        class={salaGabrielCardClass}
                                        data-value="salaGabriel"
                                        onclick={handleSalaSelect}
                                      >
                                        <div class="card-row">
                                          <span
                                            class="color-dot color-dot-blue"
                                          ></span>
                                          <div class="card-title">
                                            Sala do Gabriel
                                          </div>
                                        </div>
                                      </div>

                                      <!-- Card Outra Localização -->
                                      <div
                                        class={outraSalaCardClass}
                                        data-value="Outra"
                                        onclick={handleSalaSelect}
                                      >
                                        <div class="card-row">
                                          <span
                                            class="color-dot color-dot-orange"
                                          ></span>
                                          <div class="card-title">Outra</div>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>

                              <!-- Teams Link Generator Component (apenas para reuniões online) -->
                              <template if:true={isOnlineMeeting}>
                                <c-teams-link-generator
                                  subject={eventData.subject}
                                  start-date-time={eventData.startDateTime}
                                  end-date-time={eventData.endDateTime}
                                  participants={selectedParticipants}
                                  organizer={currentUserInfo}
                                  appointment-type={appointmentType}
                                  link-reuniao={linkReuniao}
                                  onlinkgenerated={handleTeamsLinkGenerated}
                                  onlinkcleared={handleTeamsLinkCleared}
                                ></c-teams-link-generator>
                              </template>

                              <!-- Localização (apenas quando "Outra" sala é selecionada) -->
                              <template if:true={isOutraSala}>
                                <div class="slds-m-top_medium">
                                  <lightning-input
                                    label="Localização"
                                    value={eventData.location}
                                    name="location"
                                    onchange={handleFieldChange}
                                    required
                                    placeholder="Endereço completo"
                                  ></lightning-input>
                                </div>
                              </template>
                            </div>
                          </div>

                          <!-- Date/Time fields - Show only after appointment type is selected -->
                          <template if:true={showDateTimeFields}>
                            <!-- Data e Hora de Início -->
                            <div
                              class="slds-col slds-size_1-of-2 slds-p-horizontal_small slds-p-bottom_small"
                            >
                              <lightning-input
                                type="datetime"
                                label="Início"
                                value={eventData.startDateTime}
                                name="startDateTime"
                                onchange={handleFieldChange}
                                required
                              >
                              </lightning-input>
                            </div>

                            <!-- Data e Hora de Término -->
                            <div
                              class="slds-col slds-size_1-of-2 slds-p-horizontal_small slds-p-bottom_small"
                            >
                              <lightning-input
                                type="datetime"
                                label="Término"
                                value={eventData.endDateTime}
                                name="endDateTime"
                                onchange={handleFieldChange}
                                required
                              >
                              </lightning-input>
                            </div>
                          </template>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Unified Contact/Lead Section - Intelligent behavior based on context -->
                  <template if:true={showLookupFields}>
                    <div class="section-container unified-contact-section">
                      <div class="section-header">
                        <h3 class="section-title">
                          <lightning-icon
                            icon-name={unifiedSectionIcon}
                            size="x-small"
                            class="slds-m-right_x-small"
                          ></lightning-icon>
                          {unifiedSectionTitle}
                        </h3>
                        <!-- Action buttons - Edit/Cancel based on context -->
                        <template if:true={showContactLeadInfo}>
                          <template if:false={isLeadEditingRestricted}>
                            <button
                              class="slds-button slds-button_icon slds-button_icon-border-filled"
                              onclick={handleEditContact}
                              title={editButtonTitle}
                            >
                              <lightning-icon
                                icon-name="utility:edit"
                                size="x-small"
                                alternative-text={editButtonAltText}
                              ></lightning-icon>
                            </button>
                          </template>
                          <template if:true={isLeadEditingRestricted}>
                            <div class="slds-text-body_small slds-text-color_weak">
                              <lightning-icon
                                icon-name="utility:lock"
                                size="xx-small"
                                class="slds-m-right_xx-small"
                              ></lightning-icon>
                              Lead associado pela automação
                            </div>
                          </template>
                        </template>
                        <!-- Cancel button - only show when editing -->
                        <template if:true={isEditingContact}>
                          <button
                            class="slds-button slds-button_icon slds-button_icon-border-filled slds-m-left_x-small"
                            onclick={handleCancelEdit}
                            title="Cancelar edição"
                          >
                            <lightning-icon
                              icon-name="utility:close"
                              size="x-small"
                              alternative-text="Cancelar"
                            ></lightning-icon>
                          </button>
                        </template>
                      </div>
                      <div class="slds-p-around_medium">

                        <!-- Contact/Lead Search Field - Show when no selection or editing -->
                        <template if:true={showContactSearchField}>
                          <div class="slds-form-element slds-m-bottom_medium">
                            <label class="slds-form-element__label">
                              <abbr class="slds-required" title="obrigatório">*</abbr>
                              {contactFieldLabel}
                            </label>
                            <div class="slds-form-element__control slds-combobox_container">
                              <div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click">
                                <lightning-input
                                  type="search"
                                  label={contactFieldLabel}
                                  variant="label-hidden"
                                  placeholder={contactFieldPlaceholder}
                                  value={selectedContactName}
                                  onchange={handleContactSearch}
                                  onclick={handleContactSearch}
                                  data-field="WhoId"
                                  class="slds-combobox__input"
                                ></lightning-input>

                                <!-- Contact Search Results Dropdown -->
                                <template if:true={showContactDropdown}>
                                  <div class="lookup-dropdown slds-dropdown slds-dropdown_fluid">
                                    <ul class="lookup-dropdown-list slds-listbox slds-listbox_vertical">
                                      <template if:true={isSearchingContacts}>
                                        <li class="lookup-dropdown-item slds-listbox__item lookup-loading-item">
                                          <div class="slds-media slds-listbox__option">
                                            <div class="slds-media__figure slds-listbox__option-icon">
                                              <lightning-spinner
                                                size="small"
                                                variant="brand"
                                                alternative-text="Carregando"
                                              ></lightning-spinner>
                                            </div>
                                            <div class="slds-media__body">
                                              <span class="slds-truncate">Buscando...</span>
                                            </div>
                                          </div>
                                        </li>
                                      </template>
                                      <template for:each={contactSearchResults} for:item="contact">
                                        <li key={contact.Id} class="lookup-dropdown-item slds-listbox__item">
                                          <div
                                            class="lookup-dropdown-item-content slds-media slds-listbox__option slds-listbox__option_plain"
                                            data-id={contact.Id}
                                            data-name={contact.DisplayName}
                                            onclick={handleContactSelect}
                                          >
                                            <lightning-icon
                                              icon-name={contact.IconName}
                                              size="x-small"
                                              class="slds-m-right_x-small"
                                            ></lightning-icon>
                                            <div class="slds-media__body">
                                              <div class="lookup-dropdown-item-title">
                                                {contact.DisplayName}
                                              </div>
                                              <div class="lookup-dropdown-item-subtitle">
                                                {contact.Type} • {contact.Email}
                                              </div>
                                            </div>
                                          </div>
                                        </li>
                                      </template>
                                      <template if:false={isSearchingContacts}>
                                        <template if:true={contactSearchResults.length}>
                                          <li class="lookup-dropdown-footer slds-listbox__item">
                                            <div class="slds-text-body_small">
                                              {contactSearchResults.length} resultados encontrados
                                            </div>
                                          </li>
                                        </template>
                                        <template if:false={contactSearchResults.length}>
                                          <li class="lookup-dropdown-item slds-listbox__item lookup-empty-item">
                                            <div class="slds-media slds-listbox__option">
                                              <div class="slds-media__body slds-text-align_center">
                                                <span class="slds-truncate">Nenhum resultado encontrado</span>
                                              </div>
                                            </div>
                                          </li>
                                        </template>
                                      </template>
                                    </ul>
                                  </div>
                                </template>
                              </div>
                            </div>
                          </div>
                        </template>

                        <!-- Unified Contact/Lead Display - Show when selected and not editing -->
                        <template if:true={showContactLeadInfo}>
                          <div class="unified-contact-display">
                            <!-- Main contact card -->
                            <div class={unifiedContactCardClass}>
                              <div class="contact-card-header">
                                <div class="contact-basic-info">
                                  <lightning-icon
                                    icon-name={selectedContactIcon}
                                    size="small"
                                    class="contact-icon"
                                  ></lightning-icon>
                                  <div class="contact-name-type">
                                    <div class="contact-name">{selectedContactName}</div>
                                  </div>
                                </div>
                                <template if:true={isAutomatedEvent}>
                                  <div class="automation-badge">
                                    <lightning-icon
                                      icon-name="utility:success"
                                      size="xx-small"
                                    ></lightning-icon>
                                    <span>Lead qualificado</span>
                                  </div>
                                </template>
                              </div>

                              <!-- Detailed information for leads -->
                              <template if:true={hasLeadInfo}>
                                <div class="contact-details-section">
                                  <div class="contact-details-grid">
                                    <div class="detail-item">
                                      <span class="detail-label">Empresa:</span>
                                      <span class="detail-value">{leadCompany}</span>
                                    </div>
                                    <div class="detail-item">
                                      <span class="detail-label">Email:</span>
                                      <span class="detail-value">{leadEmail}</span>
                                    </div>
                                    <div class="detail-item">
                                      <span class="detail-label">Telefone:</span>
                                      <span class="detail-value">{leadPhone}</span>
                                    </div>
                                  </div>
                                  <div class="contact-actions">
                                    <button
                                      class="slds-button slds-button_neutral slds-button_small"
                                      onclick={navigateToLead}
                                    >
                                      <lightning-icon
                                        icon-name="utility:preview"
                                        size="x-small"
                                        class="slds-button__icon slds-button__icon_left"
                                      ></lightning-icon>
                                      Ver Detalhes
                                    </button>
                                  </div>
                                </div>
                              </template>

                              <!-- Detailed information for contacts -->
                              <template if:true={hasContactInfo}>
                                <template if:false={hasLeadInfo}>
                                  <div class="contact-details-section">
                                    <div class="contact-details-grid">
                                      <div class="detail-item">
                                        <span class="detail-label">Cargo:</span>
                                        <span class="detail-value">{contactTitle}</span>
                                      </div>
                                      <div class="detail-item">
                                        <span class="detail-label">Email:</span>
                                        <span class="detail-value">{contactEmail}</span>
                                      </div>
                                      <div class="detail-item">
                                        <span class="detail-label">Telefone:</span>
                                        <span class="detail-value">{contactPhone}</span>
                                      </div>
                                      <template if:true={contactCompany}>
                                        <div class="detail-item">
                                          <span class="detail-label">Empresa:</span>
                                          <span class="detail-value">{contactCompany}</span>
                                        </div>
                                      </template>
                                    </div>
                                    <div class="contact-actions">
                                      <button
                                        class="slds-button slds-button_neutral slds-button_small"
                                        onclick={navigateToContact}
                                      >
                                        <lightning-icon
                                          icon-name="utility:preview"
                                          size="x-small"
                                          class="slds-button__icon slds-button__icon_left"
                                        ></lightning-icon>
                                        Ver Detalhes
                                      </button>
                                    </div>
                                  </div>
                                </template>
                              </template>
                            </div>
                          </div>
                        </template>
                      </div>
                    </div>
                  </template>



                  <!-- Participantes Obrigatórios -->
                  <div class="section-container">
                    <div class="section-header">
                      <h3 class="section-title">
                        <lightning-icon
                          icon-name="utility:groups"
                          size="x-small"
                          class="slds-m-right_x-small"
                        ></lightning-icon>
                        Participantes
                      </h3>
                    </div>

                    <div class="slds-p-around_medium">
                      <div class="participants-container">
                        <!-- Gestor Dropdown -->
                        <div class={gestorDropdownClass}>
                          <div class="dropdown-label-container">
                            <lightning-icon
                              icon-name="utility:user"
                              size="x-small"
                              class="dropdown-icon"
                            ></lightning-icon>
                            <span class="dropdown-label"
                              >Gestor (Opcional)</span
                            >
                          </div>
                          <lightning-combobox
                            name="gestor"
                            placeholder="Selecionar gestor..."
                            options={userOptions}
                            value={selectedGestorName}
                            onchange={handleParticipantSelect}
                            variant="standard"
                            class="enhanced-combobox"
                          >
                          </lightning-combobox>
                        </div>

                        <!-- Líder Comercial Dropdown -->
                        <div class={liderComercialDropdownClass}>
                          <div class="dropdown-label-container">
                            <lightning-icon
                              icon-name="utility:salesforce1"
                              size="x-small"
                              class="dropdown-icon"
                            ></lightning-icon>
                            <span class="dropdown-label"
                              >Líder Comercial (Opcional)</span
                            >
                          </div>
                          <lightning-combobox
                            name="liderComercial"
                            placeholder="Selecionar líder comercial..."
                            options={userOptions}
                            value={selectedLiderComercialName}
                            onchange={handleParticipantSelect}
                            variant="standard"
                            class="enhanced-combobox"
                          >
                          </lightning-combobox>
                        </div>

                        <!-- SDR Dropdown -->
                        <div class={sdrDropdownClass}>
                          <div class="dropdown-label-container">
                            <lightning-icon
                              icon-name="utility:lead"
                              size="x-small"
                              class="dropdown-icon"
                            ></lightning-icon>
                            <span class="dropdown-label">SDR (Opcional)</span>
                          </div>
                          <lightning-combobox
                            name="sdr"
                            placeholder="Selecionar SDR..."
                            options={userOptions}
                            value={selectedSdrName}
                            onchange={handleParticipantSelect}
                            variant="standard"
                            class="enhanced-combobox"
                          >
                          </lightning-combobox>
                        </div>
                      </div>

                      <!-- Selected Participants Display -->
                      <template if:true={hasSelectedParticipants}>
                        <div class="selected-participants-section">
                          <div class="selected-participants-header">
                            <h4 class="selected-participants-title">
                              <lightning-icon
                                icon-name="utility:user"
                                size="xx-small"
                                class="slds-m-right_x-small"
                              ></lightning-icon>
                              Participantes Selecionados
                            </h4>
                          </div>
                          <div class="selected-participants-display">
                            <c-event-participant-display
                              gestor-name={selectedGestorName}
                              lider-comercial-name={selectedLiderComercialName}
                              sdr-name={selectedSdrName}
                              display-mode="compact"
                              max-participants="3"
                              show-photos="true"
                              show-roles="true"
                              custom-class="appointment-participants"
                            ></c-event-participant-display>
                          </div>
                        </div>
                      </template>

                      <!-- Participants Validation Error - Removed since participants are now optional -->
                      <!--
                  <template if:true={participantsValidationError}>
                    <div class="slds-form-element__help participants-error">
                      {participantsValidationError}
                    </div>
                  </template>
                  -->
                    </div>
                  </div>

                  <!-- Descrição -->
                  <!-- Campo Description ocultado para evitar que o usuário modifique o link da reunião -->
                  <!--
              <div
                class="slds-col slds-size_1-of-1 slds-p-horizontal_small slds-p-bottom_small"
              >
                <lightning-textarea
                  label="Descrição"
                  value={eventData.description}
                  name="description"
                  onchange={handleFieldChange}
                  placeholder="Adicione detalhes importantes sobre o compromisso..."
                >
                </lightning-textarea>
              </div>
              -->

                  <!-- Status da Reunião -->
                  <div class="section-container">
                    <div class="section-header">
                      <h3 class="section-title">
                        <lightning-icon
                          icon-name="utility:check"
                          size="x-small"
                          class="slds-m-right_x-small"
                        ></lightning-icon>
                        Status da Reunião
                      </h3>
                    </div>

                    <div class="slds-p-around_medium">
                      <div class="slds-form-element">
                        <div class="slds-form-element__control">
                          <lightning-combobox
                            label="Status da Reunião"
                            name="statusReuniao"
                            value={statusReuniao}
                            options={statusOptions}
                            onchange={handleFieldChange}
                            variant="label-stacked"
                            placeholder="Selecione o status da reunião"
                          >
                          </lightning-combobox>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Availability Dashboard - Temporarily Hidden -->
                  <!--
              <template if:true={showAvailabilityDashboard}>
                <div class="section-container">
                  <div class="section-header">
                    <h3 class="section-title">
                      <lightning-icon
                        icon-name="utility:clock"
                        size="x-small"
                        class="slds-m-right_x-small"
                      ></lightning-icon>
                      Disponibilidade dos Participantes
                    </h3>
                  </div>

                  <div class="slds-p-around_medium">
                    <c-availability-dashboard
                      selected-date={eventData.startDateTime}
                      selected-users={selectedParticipants}
                      meeting-duration="60"
                      working-hours-start="8"
                      working-hours-end="18"
                      exclude-event-id={eventId}
                      ontimeslotselect={handleTimeSlotSelect}
                    >
                    </c-availability-dashboard>
                  </div>
                </div>
              </template>
              -->
                </div>
                <!-- End Event Tab Content -->

                <!-- Opportunity Tab Content -->
                <div
                  id="opportunity-tab-content"
                  class={opportunityTabContentClass}
                  role="tabpanel"
                  aria-labelledby="opportunity-tab"
                >
                  <template if:true={hasLeadOpportunityData}>
                    <!-- Lead Information Section -->
                    <div class="section-container">
                      <div class="section-header">
                        <h3 class="section-title">
                          <lightning-icon
                            icon-name="standard:lead"
                            size="x-small"
                            class="slds-m-right_x-small"
                          ></lightning-icon>
                          Informações do Lead
                        </h3>
                      </div>

                      <div class="slds-p-around_medium">
                        <div class="slds-grid slds-wrap slds-gutters">
                          <div class="slds-col slds-size_1-of-2">
                            <div class="slds-form-element">
                              <label
                                class="slds-form-element__label slds-text-body_small"
                                >Nome</label
                              >
                              <div class="slds-form-element__control">
                                <span class="slds-text-body_regular"
                                  >{leadName}</span
                                >
                              </div>
                            </div>
                          </div>
                          <div class="slds-col slds-size_1-of-2">
                            <div class="slds-form-element">
                              <label
                                class="slds-form-element__label slds-text-body_small"
                                >Empresa</label
                              >
                              <div class="slds-form-element__control">
                                <span class="slds-text-body_regular"
                                  >{leadCompany}</span
                                >
                              </div>
                            </div>
                          </div>
                          <div class="slds-col slds-size_1-of-2">
                            <div class="slds-form-element">
                              <label
                                class="slds-form-element__label slds-text-body_small"
                                >Email</label
                              >
                              <div class="slds-form-element__control">
                                <span class="slds-text-body_regular"
                                  >{leadEmail}</span
                                >
                              </div>
                            </div>
                          </div>
                          <div class="slds-col slds-size_1-of-2">
                            <div class="slds-form-element">
                              <label
                                class="slds-form-element__label slds-text-body_small"
                                >Telefone</label
                              >
                              <div class="slds-form-element__control">
                                <span class="slds-text-body_regular"
                                  >{leadPhone}</span
                                >
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- Opportunity Management Section -->
                    <div class="section-container">
                      <div class="section-header">
                        <h3 class="section-title">
                          <lightning-icon
                            icon-name="standard:opportunity"
                            size="x-small"
                            class="slds-m-right_x-small"
                          ></lightning-icon>
                          Gestão da Oportunidade
                        </h3>
                      </div>

                      <div class="slds-p-around_medium">
                        <div class="slds-grid slds-wrap slds-gutters">
                          <!-- Opportunity Stage -->
                          <div class="slds-col slds-size_1-of-2">
                            <lightning-combobox
                              label="Estágio da Oportunidade"
                              value={leadOpportunityStage}
                              options={stageOptions}
                              onchange={handleLeadOpportunityFieldChange}
                              data-field="opportunityStage"
                            >
                            </lightning-combobox>
                          </div>

                          <!-- Opportunity Probability -->
                          <div class="slds-col slds-size_1-of-2">
                            <lightning-combobox
                              label="Probabilidade"
                              value={leadOpportunityProbability}
                              options={probabilityOptions}
                              onchange={handleLeadOpportunityFieldChange}
                              data-field="opportunityProbability"
                            >
                            </lightning-combobox>
                          </div>

                          <!-- Close Date -->
                          <div class="slds-col slds-size_1-of-2">
                            <lightning-input
                              type="date"
                              label="Data Esperada de Fechamento"
                              value={leadOpportunityCloseDate}
                              onchange={handleLeadOpportunityFieldChange}
                              data-field="opportunityCloseDate"
                            >
                            </lightning-input>
                          </div>

                          <!-- Product Type -->
                          <div class="slds-col slds-size_1-of-2">
                            <lightning-combobox
                              label="Produto"
                              value={leadOpportunityType}
                              options={productOptions}
                              onchange={handleLeadOpportunityFieldChange}
                              data-field="opportunityType"
                            >
                            </lightning-combobox>
                          </div>

                          <!-- Amount -->
                          <div class="slds-col slds-size_1-of-1">
                            <lightning-input
                              type="number"
                              label="Valor Estimado"
                              value={leadOpportunityAmount}
                              onchange={handleLeadOpportunityFieldChange}
                              data-field="opportunityAmount"
                              formatter="currency"
                              step="0.01"
                            >
                            </lightning-input>
                          </div>
                        </div>
                      </div>
                    </div>
                  </template>

                  <template if:false={hasLeadOpportunityData}>
                    <div class="slds-p-around_large slds-text-align_center">
                      <lightning-icon
                        icon-name="utility:info"
                        size="medium"
                        class="slds-m-bottom_small"
                      ></lightning-icon>
                      <p class="slds-text-body_regular">
                        Esta aba mostra informações da oportunidade quando o
                        evento está associado a um Lead.
                      </p>
                    </div>
                  </template>
                </div>
                <!-- End Opportunity Tab Content -->
              </div>
              <!-- End Tabs -->
            </template>
          </div>

          <!-- Footer com botão de nota e botão Salvar -->
          <footer class="slds-modal__footer">
            <button
              class="note-button"
              onclick={handleAddNote}
              title="Adicionar Nota"
            >
              <lightning-icon
                icon-name="utility:note"
                size="small"
              ></lightning-icon>
              Adicionar Nota
            </button>
            <button
              class="slds-button slds-button_brand full-width-button"
              onclick={saveAppointment}
              disabled={isLoading}
            >
              Salvar
            </button>
          </footer>
        </div>
      </section>
      <div class="slds-backdrop slds-backdrop_open"></div>
    </div>
  </template>
</template>