<!--
  Client Tracking Pills LWC Template
  Displays circular avatar buttons for active/recurring clients in sidebar
-->
<template>
    <!-- Main Container -->
    <div class={containerClass} if:true={shouldShowComponent}>
        <!-- Header Section -->
        <div class="avatars-header">
            <div class="avatars-title">
                <span class="title-text">Recorrências</span>
                <span class="client-count">({activeClients.length})</span>
            </div>

            <!-- Clear Filters Button -->
            <div if:true={shouldShowClearButton} class="clear-filters">
                <button
                    class="clear-button-custom"
                    onclick={handleClearFilters}
                    title="Limpar filtros">
                    ×
                </button>
            </div>
        </div>

        <!-- Avatars Container -->
        <div class="avatars-container">
            <!-- Client Avatars -->
            <div class="avatars-list">
                <template for:each={visibleClients} for:item="client">
                    <!-- First item with dynamic layout -->
                    <template if:true={client.isFirstItem}>
                        <div key={client.clientId}
                             class={client.avatarClass}
                             data-client-id={client.clientId}
                             data-client-name={client.clientName}
                             onclick={handlePillClick}
                             title={client.clientName}>

                            <!-- Show as circle with initial when another item is expanded -->
                            <template if:true={client.showAsCircle}>
                                <span class="avatar-initial">{client.clientInitial}</span>
                            </template>

                            <!-- Show as pill with name when no other item is expanded -->
                            <template if:false={client.showAsCircle}>
                                <span class="first-item-name">{client.clientName}</span>
                            </template>
                        </div>
                    </template>

                    <!-- Regular items -->
                    <template if:false={client.isFirstItem}>
                        <!-- Expanded regular item -->
                        <template if:true={client.isExpanded}>
                            <div key={client.clientId}
                                 class={client.avatarClass}
                                 data-client-id={client.clientId}
                                 data-client-name={client.clientName}
                                 onclick={handlePillClick}
                                 title={client.clientName}>

                                <!-- Client Name Only -->
                                <span class="expanded-item-name">{client.clientName}</span>
                            </div>
                        </template>

                        <!-- Collapsed regular item -->
                        <template if:false={client.isExpanded}>
                            <div key={client.clientId}
                                 class={client.avatarClass}
                                 data-client-id={client.clientId}
                                 data-client-name={client.clientName}
                                 onclick={handlePillClick}
                                 title={client.clientName}>

                                <!-- Client Initial -->
                                <span class="avatar-initial">{client.clientInitial}</span>
                            </div>
                        </template>
                    </template>
                </template>
            </div>

            <!-- Show More/Less Toggle -->
            <div if:true={hasMoreClients} class="toggle-container">
                <lightning-button
                    label={toggleButtonLabel}
                    variant="neutral"
                    size="small"
                    onclick={handleToggleShowAll}
                    class="toggle-button">
                </lightning-button>
            </div>
        </div>
        
        <!-- Loading State - Removed to prevent flickering -->
        
        <!-- Error State -->
        <div if:true={error} class="error-container">
            <lightning-icon 
                icon-name="utility:error" 
                size="small" 
                variant="error" 
                class="error-icon">
            </lightning-icon>
            <span class="error-text">Erro ao carregar clientes ativos</span>
        </div>
    </div>
    
    <!-- Empty State (when no active clients) -->
    <div if:true={shouldShowEmptyState} class="empty-state">
        <lightning-icon 
            icon-name="utility:info" 
            size="small" 
            class="empty-icon">
        </lightning-icon>
        <span class="empty-text">Nenhum cliente ativo encontrado para este período</span>
    </div>
</template>
